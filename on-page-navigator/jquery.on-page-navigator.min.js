//
// jquery.on-page-navigator
// desc: add one page navigation based on anchors, highlights current page position
// version: 0.2
// requires: jQuery 1.7+

// how to use?
// init:     $(parent_selector).onPageNavigator(options)
// destroy:  $(parent_selector).onPageNavigator('destroy')

// options:
//   speed: 1000                      // speed of autoscroll
//   topOffset: 0                     // top offset of destination position
//   callbackBefore: (el) ->          // callback before autoscroll begins, gets raw clicked element
//   callbackAfter: (el) ->           // callback after autoscroll ends, gets raw clicked element
//   callbackGetHighlight: (el) ->    // callback when current navigation element is highlighted, gets raw current element
//   callbackLostHighlight: ->        // callback when all elements lost highlight, means window is outside of any element in page navigation

(function(){var e,t,n,r;e=jQuery,r=null,e.fn.onPageNavigator=function(t){return n[t]?n[t].apply(this,Array.prototype.slice.call(arguments,1)):typeof t=="object"||!t?n.init.apply(this,arguments):e.error("Method "+t+" does not exist on jQuery.onPageNavigator")},n={init:function(n){var i,s;return i={speed:1e3,topOffset:0,callbackBefore:function(){},callbackAfter:function(){},callbackGetHighlight:function(){},callbackLostHighlight:function(){}},s=e.extend({},i,n),r=new t(this,s),this},destroy:function(){return r.destroy(),this}},t=function(){function t(e,t){this.parent=e,this.settings=t,this.initNavigateEvent(),this.initHighlightingEvent()}return t.prototype.initNavigateEvent=function(){var t=this;return e(this.parent).on("click.navigator","a",function(e){return e.preventDefault(),t.onNavigate(e.currentTarget)})},t.prototype.onNavigate=function(t){var n,r,i,s;return n=e(t),s=this.settings,s.callbackBefore(t),i=n.attr("href"),r=e(i).offset().top-s.topOffset,e("html:not(:animated),body:not(:animated)").animate({scrollTop:r},s.speed,function(){return s.callbackAfter(t)})},t.prototype.initHighlightingEvent=function(){var t,n,r=this;return n=[],t=e(this.parent),t.find("a").each(function(t){return n.push(e(this).attr("href"))}),e(window).on("scroll.navigator",function(e){return r.highlight(e.target,n)})},t.prototype.highlight=function(t,n){var r,i,s,o,u,a,f,l,c,h;f=e(t).scrollTop(),o=null,i=e(this.parent);for(c=0,h=n.length;c<h;c++)a=n[c],l=e(a).offset().top-this.settings.topOffset-10,u=e(a).offset().top+e(a).outerHeight(),f>l&&f<u&&(o=a);if(o!==null){r=i.find("a[href="+o+"]");if(r.hasClass("active"))return;return i.find("a").removeClass("active"),s=r,s.addClass("active"),this.settings.callbackGetHighlight(s[0])}return i.find("a").removeClass("active"),this.settings.callbackLostHighlight()},t.prototype.destroy=function(){return e(this.parent).off(".navigator"),e(window).off(".navigator")},t}()}).call(this);